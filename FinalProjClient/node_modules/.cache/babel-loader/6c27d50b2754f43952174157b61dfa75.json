{"ast":null,"code":"import _defineProperty from \"/Users/SeanQuinn/Desktop/ReactJS3/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//import { getPerson } from \"./actions/actionCreators\";\n// Orderly interface to the REST server, providing:\n// 1. Standard URL base\n// 2. Standard headers to manage CORS and content type\n// 3. Guarantee that 4xx and 5xx results are returned as\n//    rejected promises, with a payload comprising an\n//    array of user-readable strings describing the error.\n// 4. All successful post operations return promises that\n//    resolve to a JS object representing the newly added\n//    entity (all fields, not just those in the post body)\n// 5. Signin and signout operations that retain relevant\n//    sessionId data.  Successful signin returns promise \n//    resolving to newly signed in user.\nconst baseURL = \"http://localhost:3001/\";\nconst headers = new Headers();\nvar sessionId;\nheaders.set('Content-Type', 'application/JSON'); //headers.set(\"Access-Control-Allow-Credentials\", true);\n//headers.set(\"Access-Control-Allow-Headers\", \"*\");\n//headers.set(\"Access-Control-Allow-Origin\", \"http://localhost:3001\");\n//headers.set(\"Access-Control-Expose-Headers\", \"Location\");\n// app.use(function(req, res, next) {\n//     next();\n//  });\n//  // No further processing needed for options calls.\n//  app.options(\"/*\", function(req, res) {\n//     res.status(200).end();\n//  });\n\nconst reqConf = {\n  headers: headers,\n  credentials: 'include'\n};\n\nfunction safeFetch(endpoint, method, body) {\n  return fetch(baseURL + endpoint, _objectSpread({\n    method: method,\n    body: body ? JSON.stringify(body) : undefined\n  }, reqConf)).then(res => {\n    if (res.ok) {\n      return res;\n    } else return res.json().then(rsp => Object.values(rsp).map(e => errorTranslate(e.tag) + e.params)).then(errors => {\n      throw errors;\n    });\n  }).catch(err => {\n    throw err;\n  });\n} // Helper functions for the comon request types, automatically\n// adding verb, headers, and error management.\n\n\nexport function post(endpoint, body) {\n  return safeFetch(endpoint, 'POST', body);\n}\nexport function put(endpoint, body) {\n  return safeFetch(endpoint, 'PUT', body);\n}\nexport function get(endpoint) {\n  return safeFetch(endpoint, 'GET');\n}\nexport function del(endpoint) {\n  return safeFetch(endpoint, 'DELETE');\n} // Functions for performing the api requests\n\n/**\n * Sign a user into the service, returning a promise of the \n * user data\n * @param {{email: string, password: string}} cred\n */\n\nexport function signIn(cred) {\n  return post(\"Ssns\", cred).then(response => {\n    let location = response.headers.get(\"Location\").split('/');\n    sessionId = location[location.length - 1];\n    return get(\"Ssns/\" + sessionId);\n  }).then(response => response.json()) // ..json() returns a Promise!\n  .then(body => get('Prss/' + body.prsId)).then(userResponse => userResponse.json()).then(rsp => rsp[0]).catch(err => {\n    console.log('err was this', err);\n    throw err;\n  }); // this err is actualyl a promise so we need\n  // a then later\n}\n/**\n * @returns {Promise} result of the sign out request\n */\n\nexport function signOut() {\n  return del(\"Ssns/\" + sessionId).catch(err => {\n    throw err;\n  });\n}\n/**\n * Register a user\n * @param {Object} user\n * @returns {Promise resolving to new user}\n */\n\nexport function register(user) {\n  return post(\"Prss\", user).then(rsp => user //    console.log('register rsp',user);\n  //   let location = rsp.headers.get(\"Location\").split('/');\n  //   return get(\"Prss/\" + location[location.length - 1]);\n  ) //.then(rsp => rsp.json()[0])\n  .catch(err => {\n    throw err;\n  });\n}\n/**\n * @returns {Promise} json parsed data\n */\n\nexport function getCnvs(userId) {\n  return get(\"Cnvs\" + (userId ? \"?owner=\" + userId : \"\")).then(res => res.json()).catch(err => {\n    throw err;\n  });\n}\nexport function putCnv(id, body) {\n  return put(\"Cnvs/\".concat(id), body).catch(err => {\n    throw err;\n  });\n}\nexport function delCnv(id) {\n  return del(\"Cnvs/\".concat(id)).catch(err => {\n    throw err;\n  });\n}\nexport function postCnv(body) {\n  return post('Cnvs', body).then(rsp => {\n    let location = rsp.headers.get(\"Location\").split('/');\n    return get(\"Cnvs/\".concat(location[location.length - 1]));\n  }).then(rsp => rsp.json());\n}\nexport function getMsgs(cnvId) {\n  return get(\"Cnvs/\".concat(cnvId, \"/Msgs\")).then(res => res.json()).catch(err => []);\n}\nexport function postMsg(body, cnvId) {\n  console.log(\"new message\", body);\n  return post(\"Cnvs/\".concat(cnvId, \"/Msgs\"), body).then(rsp => {\n    console.log(\"res was \", rsp);\n    let location = rsp.headers.get(\"Location\").split('/');\n    return get(\"Msgs/\".concat(location[location.length - 1]));\n  }).then(rsp => rsp.json()).catch(err => {\n    throw err;\n  });\n}\nexport function getPerson(prsId) {\n  return get(\"Prss/\" + prsId).then(res => res.json()).catch(err => {\n    throw err;\n  });\n}\nconst errMap = {\n  en: {\n    missingField: 'Field missing from request: ',\n    badValue: 'Field has bad value: ',\n    notFound: 'Entity not present in DB',\n    badLogin: 'Email/password combination invalid',\n    dupEmail: 'Email duplicates an existing email',\n    noTerms: 'Acceptance of terms is required',\n    forbiddenRole: 'Role specified is not permitted.',\n    noOldPwd: 'Change of password requires an old password',\n    oldPwdMismatch: 'Old password that was provided is incorrect.',\n    dupTitle: 'Conversation title duplicates an existing one',\n    dupEnrollment: 'Duplicate enrollment',\n    forbiddenField: 'Field in body not allowed.',\n    queryFailed: 'Query failed (server problem).'\n  },\n  es: {\n    missingField: '[ES] Field missing from request: ',\n    badValue: '[ES] Field has bad value: ',\n    notFound: '[ES] Entity not present in DB',\n    badLogin: '[ES] Email/password combination invalid',\n    dupEmail: '[ES] Email duplicates an existing email',\n    noTerms: '[ES] Acceptance of terms is required',\n    forbiddenRole: '[ES] Role specified is not permitted.',\n    noOldPwd: '[ES] Change of password requires an old password',\n    oldPwdMismatch: '[ES] Old password that was provided is incorrect.',\n    dupTitle: '[ES] Conversation title duplicates an existing one',\n    dupEnrollment: '[ES] Duplicate enrollment',\n    forbiddenField: '[ES] Field in body not allowed.',\n    queryFailed: '[ES] Query failed (server problem).'\n  },\n  swe: {\n    missingField: 'Ett fält saknas: ',\n    badValue: 'Fält har dåligt värde: ',\n    notFound: 'Entitet saknas i DB',\n    badLogin: 'Email/lösenord kombination ogilltig',\n    dupEmail: 'Email duplicerar en existerande email',\n    noTerms: 'Villkoren måste accepteras',\n    forbiddenRole: 'Angiven roll förjuden',\n    noOldPwd: 'Tidiagre lösenord krav för att updatera lösenordet',\n    oldPwdMismatch: 'Tidigare lösenord felaktigt',\n    dupTitle: 'Konversationstitel duplicerar tidigare existerande titel',\n    dupEnrollment: 'Duplicerad inskrivning',\n    forbiddenField: 'Förbjudet fält i meddelandekroppen',\n    queryFailed: 'Förfrågan misslyckades (server problem).'\n  }\n};\n/**\n * @param {string} errTag\n * @param {string} lang\n */\n\nexport function errorTranslate(errTag, lang = 'en') {\n  return errMap[lang][errTag] || 'Unknown Error!';\n}","map":{"version":3,"sources":["/Users/SeanQuinn/Desktop/ReactJS3/src/api.js"],"names":["baseURL","headers","Headers","sessionId","set","reqConf","credentials","safeFetch","endpoint","method","body","fetch","JSON","stringify","undefined","then","res","ok","json","rsp","Object","values","map","e","errorTranslate","tag","params","errors","catch","err","post","put","get","del","signIn","cred","response","location","split","length","prsId","userResponse","console","log","signOut","register","user","getCnvs","userId","putCnv","id","delCnv","postCnv","getMsgs","cnvId","postMsg","getPerson","errMap","en","missingField","badValue","notFound","badLogin","dupEmail","noTerms","forbiddenRole","noOldPwd","oldPwdMismatch","dupTitle","dupEnrollment","forbiddenField","queryFailed","es","swe","errTag","lang"],"mappings":"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","sourcesContent":["//import { getPerson } from \"./actions/actionCreators\";\n\n// Orderly interface to the REST server, providing:\n// 1. Standard URL base\n// 2. Standard headers to manage CORS and content type\n// 3. Guarantee that 4xx and 5xx results are returned as\n//    rejected promises, with a payload comprising an\n//    array of user-readable strings describing the error.\n// 4. All successful post operations return promises that\n//    resolve to a JS object representing the newly added\n//    entity (all fields, not just those in the post body)\n// 5. Signin and signout operations that retain relevant\n//    sessionId data.  Successful signin returns promise \n//    resolving to newly signed in user.\n\nconst baseURL = \"http://localhost:3001/\";\nconst headers = new Headers();\nvar sessionId;\n\nheaders.set('Content-Type', 'application/JSON');\n//headers.set(\"Access-Control-Allow-Credentials\", true);\n//headers.set(\"Access-Control-Allow-Headers\", \"*\");\n//headers.set(\"Access-Control-Allow-Origin\", \"http://localhost:3001\");\n//headers.set(\"Access-Control-Expose-Headers\", \"Location\");\n\n\n// app.use(function(req, res, next) {\n\n//     next();\n//  });\n \n//  // No further processing needed for options calls.\n//  app.options(\"/*\", function(req, res) {\n//     res.status(200).end();\n//  });\n \n\nconst reqConf = {\n    headers: headers,\n    credentials: 'include',\n};\n\nfunction safeFetch(endpoint, method, body) {\n    return fetch(baseURL + endpoint, {\n       method: method,\n       body: (body ? JSON.stringify(body) : undefined),\n       ...reqConf\n    }).then(res => {\n          if (res.ok) {\n             return res;\n          } else\n             return res.json().then(rsp => Object.values(rsp)\n              .map(e => errorTranslate(e.tag) + e.params))\n              .then(errors => {throw errors});\n    }).catch(err => {throw err});\n }\n// Helper functions for the comon request types, automatically\n// adding verb, headers, and error management.\nexport function post(endpoint, body) {\n    return safeFetch(endpoint, 'POST', body);\n}\n\nexport function put(endpoint, body) {\n    return safeFetch(endpoint, 'PUT', body);\n}\n\nexport function get(endpoint) {\n    return safeFetch(endpoint, 'GET');\n}\n\nexport function del(endpoint) {\n    return safeFetch(endpoint, 'DELETE');\n}\n\n// Functions for performing the api requests\n\n/**\n * Sign a user into the service, returning a promise of the \n * user data\n * @param {{email: string, password: string}} cred\n */\nexport function signIn(cred) {\n   return post(\"Ssns\", cred)\n      .then(response => {\n         let location = response.headers.get(\"Location\").split('/');\n\n         sessionId = location[location.length - 1];\n         return get(\"Ssns/\" + sessionId)\n      })\n      .then(response => response.json())   // ..json() returns a Promise!\n      .then(body => get('Prss/' + body.prsId))\n      .then(userResponse => userResponse.json())\n      .then(rsp => rsp[0])\n      .catch(err => {console.log('err was this',err);throw err}) // this err is actualyl a promise so we need\n                                 // a then later\n}\n\n/**\n * @returns {Promise} result of the sign out request\n */\nexport function signOut() {\n    return del(\"Ssns/\" + sessionId)\n    .catch(err => {throw err});\n}\n\n/**\n * Register a user\n * @param {Object} user\n * @returns {Promise resolving to new user}\n */\nexport function register(user) {\n   return post(\"Prss\", user)\n   .then(rsp => \n       user\n    //    console.log('register rsp',user);\n    //   let location = rsp.headers.get(\"Location\").split('/');\n    //   return get(\"Prss/\" + location[location.length - 1]);\n   )\n   //.then(rsp => rsp.json()[0])\n   .catch(err => {throw err});\n}\n\n/**\n * @returns {Promise} json parsed data\n */\nexport function getCnvs(userId) {\n    return get(\"Cnvs\" + (userId ? \"?owner=\"+userId : \"\"))\n    .then((res) => res.json())\n    .catch(err => {throw err})\n}\n\nexport function putCnv(id, body) {\n    return put(`Cnvs/${id}`, body)\n    .catch(err => {throw err})\n}\n\nexport function delCnv(id) {\n    return del(`Cnvs/${id}`)\n    .catch(err => {throw err});\n}\n\nexport function postCnv(body) {\n    return post('Cnvs', body).then(rsp => {\n      let location = rsp.headers.get(\"Location\").split('/');\n      return get(`Cnvs/${location[location.length-1]}`);\n   })\n   .then(rsp => rsp.json());\n}\n\nexport function getMsgs(cnvId) {\n    return get(`Cnvs/${cnvId}/Msgs`).then((res) => res.json())\n    .catch(err => []);\n}\n\nexport function postMsg (body, cnvId) {\n    console.log(\"new message\", body)\n    return post(`Cnvs/${cnvId}/Msgs`, body).then(rsp => {\n       console.log(\"res was \", rsp)\n       let location = rsp.headers.get(\"Location\").split('/');\n       return get(`Msgs/${location[location.length-1]}`);\n   })\n   .then(rsp => rsp.json())\n   .catch(err => {\n       throw err\n    });\n}\n\nexport function getPerson(prsId) {\n    return get (\"Prss/\" + prsId)\n    .then(res => res.json())\n    .catch(err => {throw err});\n}\n\nconst errMap = {\n    en: {\n        missingField: 'Field missing from request: ',\n        badValue: 'Field has bad value: ',\n        notFound: 'Entity not present in DB',\n        badLogin: 'Email/password combination invalid',\n        dupEmail: 'Email duplicates an existing email',\n        noTerms: 'Acceptance of terms is required',\n        forbiddenRole: 'Role specified is not permitted.',\n        noOldPwd: 'Change of password requires an old password',\n        oldPwdMismatch: 'Old password that was provided is incorrect.',\n        dupTitle: 'Conversation title duplicates an existing one',\n        dupEnrollment: 'Duplicate enrollment',\n        forbiddenField: 'Field in body not allowed.',\n        queryFailed: 'Query failed (server problem).'\n    },\n    es: {\n        missingField: '[ES] Field missing from request: ',\n        badValue: '[ES] Field has bad value: ',\n        notFound: '[ES] Entity not present in DB',\n        badLogin: '[ES] Email/password combination invalid',\n        dupEmail: '[ES] Email duplicates an existing email',\n        noTerms: '[ES] Acceptance of terms is required',\n        forbiddenRole: '[ES] Role specified is not permitted.',\n        noOldPwd: '[ES] Change of password requires an old password',\n        oldPwdMismatch: '[ES] Old password that was provided is incorrect.',\n        dupTitle: '[ES] Conversation title duplicates an existing one',\n        dupEnrollment: '[ES] Duplicate enrollment',\n        forbiddenField: '[ES] Field in body not allowed.',\n        queryFailed: '[ES] Query failed (server problem).'\n    },\n    swe: {\n        missingField: 'Ett fält saknas: ',\n        badValue: 'Fält har dåligt värde: ',\n        notFound: 'Entitet saknas i DB',\n        badLogin: 'Email/lösenord kombination ogilltig',\n        dupEmail: 'Email duplicerar en existerande email',\n        noTerms: 'Villkoren måste accepteras',\n        forbiddenRole: 'Angiven roll förjuden',\n        noOldPwd: 'Tidiagre lösenord krav för att updatera lösenordet',\n        oldPwdMismatch: 'Tidigare lösenord felaktigt',\n        dupTitle: 'Konversationstitel duplicerar tidigare existerande titel',\n        dupEnrollment: 'Duplicerad inskrivning',\n        forbiddenField: 'Förbjudet fält i meddelandekroppen',\n        queryFailed: 'Förfrågan misslyckades (server problem).'\n    }\n}\n\n/**\n * @param {string} errTag\n * @param {string} lang\n */\nexport function errorTranslate(errTag, lang = 'en') {\n    return errMap[lang][errTag] || 'Unknown Error!';\n}\n"]},"metadata":{},"sourceType":"module"}